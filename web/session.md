# Session
세션은 클라이언트 별로 서버에 저장되는 정보이다. <br>
사용자 컴퓨터에 저장되던 쿠키와 다르게 서버에 저장되므로, 비교적 보안이 필요한 데이터는 쿠키보다 세션에 저장한다.
서버가 종료되거나 유효기간이 지나면 사라진다.

## 세션 이용 방법
<img width="684" alt="스크린샷 2023-05-11 오후 9 39 41" src="https://github.com/minwestgit/Tech-Interview-Study/assets/70561950/5642c200-c371-4c71-b9d2-421dfea31c3a">

1. 웹 클라이언트가 서버에게 요청을 보내면 서버는 클라이언트를 식별하는 session id를 생성한다.(JSESSIONID라는 이름으로 세션ID 생성)
2. 서버는 session id로 key와 value를 저장하는 Httpsession을 생성하고, session id를 저장하고있는 쿠키를 생성하여 클라이언트한테 전송한다. ›
3. 클라이언트는 서버 측에 요청을 보낼 때, session id를 가지고 있는 쿠키를 전송한다.
4. 서버는 쿠키의 session id로 Httpsession을찾는다.<br>
javax.servlet.http.HttpSession으로 세션 데이터를 다룰 수 있다.

### JSESSIONID

톰캣 컨테이너에서 세션을 유지하기 위해 발급하는 키.<br>
HTTP 프로토콜은 stateless하다. 요청시마다 새로운 연결이 생성되고 응답후 연결은 끊기게 되므로 상태를 유지할 수 없다. 따라서 상태를 저장하기 위해서 톰캣은 JSESSIONID 쿠키를 클라이언트에게 발급해주고 이 값을 통해 세션을 유지할 수 있도록 한다.<br>

동작 방식
1. 브라우저에 최초 접근 시 톰캣은 Response 헤더에 JSESSIONID값이 발급된다.
2. 브라우저 재요청시 Response를 통해 받은 JSESSIONID를 Request 헤더의 쿠키에 값을 넣어 서버에 요청한다. 쿠키를 통해 JSESSIONID 값을 전달받게 되면 서버는 새로운 JSESSIONID 값을 Response 헤더에 발급받지 않는다.
3. 클라이언트로부터 전달받은 JSESSIONID값을 기준으로 서버에서는 세션 메모리 영역에 상태를 유지할 값들을 저장할 수 있게 된다. (HttpSession 등)

유지 범위
- 동일한 Full 도메인 ( 서브도메인이 다를 경우 쿠키가 유지되지 않기 때문)
- 포트번호는 달라도 무관하다.

한계
- 톰캣 컨테이너를 2대 이상 사용하게 될 경우 세션을 유지할 수 없다. 유지가 되기 위해서는 세션 클러스터링 환경을 구축하여야 한다.

[https://junjunrecord.tistory.com/95](https://junjunrecord.tistory.com/95) <br>
<br>


## 서버가 여러 대일 때 세션을 처리하는 방법

세션을 통해서 HTTP의 Stateless(상태유지x), Connectionless(응답받으면연결끊음)한 문제점을 해결할 수 있다. 
세션이란 일정 시간(방문자가 웹 브라우저를 통해 웹 서버에 접속한 시점으로부터 웹 브라우저를 종료함으로써 연결을 끝내는 시점)동안 같은 사용자(정확하게 브라우저를 말한다)로 부터 들어오는 일련의 요구를 하나의 상태로 보고 그 상태를 일정하게 유지시키는 기술이다.
즉, 방문자가 웹서버에 접속해 있는 상태를 하나의 단위로 보고 세션이라고 칭한다.

### Sticky Session
Sticky Session은 첫 요청에 대한 응답을 준 서버에게 끈적끈적하게 붙어서 이후의 모든 요청들을 해당 서버로만 보내는 방법이다. 쿠키나 클라이언트의 IP tracking을 활용하여 기능을 제공한다.<br>
단점 : 로드 밸런싱 효율이 떨어진다. 하나의 서버만 사용하게되는 상황이 발생한다.

### Session Clustering
Session Clustering이란 각 서버의 세션 저장소를 하나로 묶어서 관리하는 것이다.
모든 서버가 동일한 세션을 공유하기 때문에 특정 서버로만 트래픽이 몰릴 필요가 없으며, 하나의 서버가 죽어도 세션 정보를 잃어버릴 일은 없게 된다. 하지만 모든 서버의 세션 데이터를 동일하게 유지하기 위해서 하나의 세션이 생기면 모든 서버의 세션 저장소를 업데이트해줘야 하며 그만큼 많은 메모리가 필요하기 때문에 성능 저하가 발생하게 된다. 또한, 새로운 서버를 만들 때마다 기존의 세션 데이터를 옮겨서 클러스터링 해줘야 하는 번거로움도 존재한다.

### Session Server
이러한 번거로움을 없애기 위해 세션만 관리하는 별도의 서버를 하나 두는 방식이 바로 Session Server 방식이다.
서버마다 세션 저장소를 둬서 관리하지 말고 세션만 관리하는 별도의 서버를 하나 두는 방식이다.
세션 서버를 사용하기 때문에 모든 서버의 세션 저장소를 업데이트해줄 필요가 없으며, 클러스터링할 필요도 없다. 또한, Redis 같은 In-memory(인메모리) 데이터 저장소를 사용함으로써 빠르게 세션을 조회할 수 있다.
