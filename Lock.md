데이터베이스는 여러 사용자들이 같은 데이터를 동시에 접근하는 상황에서, 데이터의 무결성과 일관성을 지키기 위해 락을 사용합니다. Lock은 트랜잭션 처리의 순차성을 보장해주는 기능을 제공합니다. 트랜잭션은 DB가 처리하는 가장 작은 단위의 처리 단위입니다. Lock은 하나의 트랜잭션이 완벽하게 끝날 때까지 다른 요청을 막아줍니다.

- 공유 락(Shared Lock)
공유 락은 데이터를 변경하지 않는 읽기 명령에 대해 주어지는 락으로 `Read Lock`이라고도 불리며 `Shared`의 앞 글자를 따서 주로 `S`로 표기합니다. 여러 사용자가 동시에 데이터를 읽어도 데이터의 일관성에는 아무런 영향을 주지 않기 때문에, 공유 락끼리는 동시에 접근이 가능합니다.

- 베타 락(Exclusive Lock)
베타 락은 데이터에 변경을 가하는 쓰기 명령들에 대해 주어지는 락으로 `Write Lock`으로도 불리며, `X`로 표기합니다. 베타 락은 이름처럼 다른 트랜잭션이 해당 자원에 접근(ex, `SELECT`, `INSERT`..) 하는 것을 막습니다. 베타 락은 트랜잭션 동안 유지됩니다. Exclusive Lock이 끝나기 전까지 어떠한 접근도 허용하지 않습니다. 이 Lock은 다른 트랜잭션이 수행되고 있는 데이터에 대해서 접근하여 Lock을 걸 수 없습니다.


**Lock 설정 레벨**
1. 데이터베이스 - 전체 데이터베이스를 기준으로 Lock이 걸립니다. 1개의 세션이 하나의 데이터베이스의 데이터에 접근할 수 있습니다. DB 전체에 영향이 있는 DB 업데이트와 같은 작업에서만 사용합니다.
2. 파일 - 데이터베이스 파일을 기준으로 Lock이 걸립니다. 데이터베이스에서 파일이란, 테이블 등과 같이 실제 데이터가 쓰여지는 물리적인 저장소를 뜻합니다. 파일 전체를 백업할 때 사용합니다.
3. 테이블 - 테이블 기준으로 Lock이 걸립니다. 전체 테이블의 대한 데이터 변경이 있을 경우 사용합니다. 테이블을 제어하는 DDL 구문을 사용할 때 Lock이 걸린다고 DDL Lock이라고도 합니다.
4. 페이지와 블럭 - 파일을 구성하는 페이지와 블록을 기준으로 Lock이 걸립니다.
5. 컬럼(Column) - 컬럼 기준으로 Lock이 걸립니다. 다만 Lock 설정 및 해제 시 리소스가 많이 듭니다. 그래서 잘 사용하지 않습니다.
6. 행(Row) - 행 수준의 Lock을 겁니다. 가장 많이 사용되는 Lock 입니다.

Blocking : Lock간(베타-베타, 베타-공유)의 경합이 발생하여 **특정 Transaction이 작업을 진행하지 못하고 멈춰선 상태**를 의미한다. 위에 설명했듯이 공유락끼리는 블로킹이 발생하지 않지만 베타락은 블로킹을 발생시킨다. 블로킹을 해소하기 위해서는 이전의 트랜잭션이 완료(commit or rollback)되어야 한다.

뒤에 들어온 트랜잭션은 이전 트랜잭션이 마무리되어야 이후 진행이 가능하다. 이런 경합은 성능에 좋지 않은 영향을 끼쳐서 **경합을 최소화**해야한다.

**교착상태(DeadLock) :** 교착상태는 두 트랜잭션이 각각 Lock을 설정하고 서로의 Lock에 접근하여 값을 얻어오려고 할 때 발생되는 **무한대기상태**를 의미한다. 교착상태가 발생하면 DBMS가 두 트랜잭션중 하나에 에러를 발생시킴으로써 문제를 해결한다. 교착상태가 발생할 가능성을 줄이기 위해서는 **접근 순서를 동일하게 하는것**이 중요하다.


Ref.
[https://velog.io/@koo8624/Database-데이터베이스-락Lock의-종류와-역할](https://velog.io/@koo8624/Database-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EB%9D%BDLock%EC%9D%98-%EC%A2%85%EB%A5%98%EC%99%80-%EC%97%AD%ED%95%A0)
<br>[https://centbin-dev.tistory.com/entry/Database-Lock-종류-및-기능](https://centbin-dev.tistory.com/entry/Database-Lock-%EC%A2%85%EB%A5%98-%EB%B0%8F-%EA%B8%B0%EB%8A%A5)
<br>[https://earth-ing.tistory.com/55](https://earth-ing.tistory.com/55)
